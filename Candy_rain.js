/*
@title: Candy_rain
@author: 
@tags: []
@addedOn: 2024-00-00
*/

const player = "p"
const candy = "c"
const chocolate = "h"
const bears = "b"
const candy_floss = "a"
const background = "f"
const cake = "k"
const apple = "l"
const banana = "n"
const grapes = "g"

setLegend(
  [ player, bitmap`
................
................
...444444444....
..44232323244...
..43333333334...
..43333333334...
..44443334444...
.....D040D......
.....D444D......
.....D444D......
......4D4.......
.....D444D......
.....D4D4D......
......444.......
......4D44......
.......44D4.....` ],
  [ candy, bitmap`
................
................
................
.....22.222.....
.....222222.....
......2222......
......8888......
.....888888.....
.....8HHHH8.....
.....8HHHH8.....
.....888888.....
......8888......
................
................
................
................` ],
  [ chocolate, bitmap`
................
................
................
.....CCCCCC.....
.....CCCCCC.....
.....CCCCCC.....
.....CCCCC3.....
.....CCC333.....
.....333333.....
.....333333.....
.....333333.....
.....333333.....
.....333333.....
................
................
................` ],
  [ bears, bitmap`
......77........
.....7777.......
..44..77..33....
..44.7777.33....
.4444....3333...
..44......33....
.4444.66.3333...
......66........
.55..6666...99..
.55...66....99..
5555.6666..9999.
.55.........99..
5555..88...9999.
......88........
.....8888.......
......88........` ],
  [ candy_floss, bitmap`
................
................
........333.....
........222.....
........333.....
........222.....
........333.....
........222.....
........333.....
........222.....
....33..333.....
....2222222.....
.....333333.....
.......222......
................
................` ],
  [ background, bitmap`
H1H1H1H1H1H1H1H1
1H1H1H1H1H1H1H1H
H1H1H1H1H1H1H1H1
1H1H1H1H1H1H1H1H
H1H1H1H1H1H1H1H1
1H1H1H1H1H1H1H1H
H1H1H1H1H1H1H1H1
1H1H1H1H1H1H1H1H
H1H1H1H1H1H1H1H1
1H1H1H1H1H1H1H1H
H1H1H1H1H1H1H1H1
1H1H1H1H1H1H1H1H
H1H1H1H1H1H1H1H1
1H1H1H1H1H1H1H1H
H1H1H1H1H1H1H1H1
1H1H1H1H1H1H1H1H` ],
  [ cake, bitmap`
................
................
................
................
................
................
.....222232.....
....22322222....
...2222223222...
...CCCCCCCCCC...
...CCCCCCCCCC...
....CCCCCCCC....
................
................
................
................` ],
  [ apple, bitmap`
................
................
........44......
.......444......
.......CC.......
.....333333.....
....33233333....
....32233333....
....33333333....
....33333333....
....33333333....
.....333333.....
................
................
................
................` ],
  [ banana, bitmap`
................
................
................
................
................
................
..........CC....
..........66....
.........666....
.......66666....
.....666666.....
...666666.......
...6666.........
................
................
................` ],
  [ grapes, bitmap`
................
................
................
...........H....
......H..HCC....
.....HC.HCC.H...
......CCCCCCC...
....H.HCC.H.H...
...HCCCCCH.H....
....HC.HC.......
...HCCH.CH......
....CH.H........
....H...........
................
................
................` ],
  
)

setSolids([])
setBackground("f")



let level = 0
let score = 0
const levels = [
  map`
g....
..n..
.l..k
.....
.....
..p..
.....`
]
addText(`Score: ${score}`,{x: 7, y: 0, color: color`0`})
setMap(levels[level])

setPushables({
  [ player ]: []
})
/*
onInput("s", () => {
  getFirst(player).y += 1
})
onInput("w", () => {
  getFirst(player).y -= 1
})
*/
onInput("d", () => {
  getFirst(player).x += 1
})
onInput("a", () => {
  getFirst(player).x -= 1
})

afterInput(() => {
  if(level == 0){
    const cakeSprite = getFirst(cake);
    const appleSprite = getFirst(apple);
    const grapesSprite = getFirst(grapes);
    const bananaSprite = getFirst(banana);


/*
if (appleSprite.x === apple.x && appleSprite.y === apple.y){
      console.log("...");
      score += 1
      clearText()
    addText(`Score: ${score}`,{x: 7, y: 0, color: color`0`})
    }

    */
   if(tilesWith(player, apple).length >= 1){
    console.log("Apple");
    score += 1
    clearText()
    addText(`Score: ${score}`,{x: 7, y: 0, color: color`0`})
    appleSprite.remove();
  }
    
    if (cakeSprite) {
      getFirst(cake).y += 1;
      if (cakeSprite.y === 6) {
        console.log("Cake removed!");
        cakeSprite.remove();
      }
    }
    if (appleSprite) {
      getFirst(apple).y += 1;
      if (appleSprite.y === 6) {
        console.log("Apple removed!");
        appleSprite.remove();
      }
    }
    if (grapesSprite) {
      getFirst(grapes).y += 1;
      if (grapesSprite.y === 6) {
        console.log("Grapes removed!");
        grapesSprite.remove();
      }
    }
    if (bananaSprite) {
      getFirst(banana).y += 1;
      if (bananaSprite.y === 6) {
        console.log("Banana removed!");
        bananaSprite.remove();
      }
    }
  }
})
